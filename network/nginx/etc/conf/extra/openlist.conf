# 代理 Openlist Web 界面
location /openlist/ {
	access_log off;
	
	proxy_pass http://openlist_backend;
	proxy_redirect off;

	# 代理头设置
	proxy_set_header Host $http_host;
	proxy_set_header X-Real-IP $remote_addr;
	proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
	proxy_set_header X-Forwarded-Proto $scheme;
	proxy_set_header Range $http_range;
	proxy_set_header If-Range $http_if_range;

	# 缓冲区优化
	proxy_buffer_size 16k;				# 单个缓冲区大小
	proxy_buffers 4 64k;				# 缓冲区数量和大小
	proxy_busy_buffers_size 128k;		# 忙碌时缓冲区大小
	proxy_max_temp_file_size 0;			# 禁用临时文件写入（强制使用内存）
	
	# 客户端限制
	client_max_body_size 20000m;
}

# 代理 Openlist WebDAV 服务
location /openlist/dav/ {
	access_log off;
	
	proxy_pass http://openlist_backend/openlist/dav/;
	
	proxy_http_version 1.1;
	proxy_set_header Host $http_host;
	proxy_set_header X-Real-IP $remote_addr;
	proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
	proxy_set_header X-Forwarded-Proto $scheme;

	# 传递 WebDAV 专用头
	proxy_set_header Depth $http_depth;
	proxy_set_header Destination $http_destination;
	proxy_set_header Overwrite $http_overwrite;
	proxy_set_header Authorization $http_authorization;

	# 大文件上传支持
	client_max_body_size 0;
	proxy_request_buffering off;

	# 覆盖为更大缓冲区
	proxy_buffer_size 64k;				# 单个缓冲区大小
	proxy_buffers 8 32k;				# 缓冲区数量和大小
	proxy_max_temp_file_size 2048m;
}